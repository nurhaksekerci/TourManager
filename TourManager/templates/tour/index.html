{% extends "tour/base.html" %}

{% block content %}
<div class="p-5">
    <div class="card my-4"  id="cardToday">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h1 class="my-1 card_title">{{ todaytitle|date:"d.m.Y" }}</h1>
            <div>
                <button onclick="downloadCard('cardToday');" class="btn btn-outline-secondary">
                    <i class="fas fa-download"></i> Excel İndir
                </button>
                <button onclick="printCard('cardToday');" class="btn btn-outline-secondary">
                    <i class="fas fa-print"></i> Yazdır
                </button>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover" style="font-size:0.8rem;">
                <thead class="thead-dark">
                    <tr>
                        <th>Etiket</th>
                        <th>İşlem Türü</th>
                        <th>Açıklama</th>
                        <th>Alış Zamanı</th>
                        <th>Tur</th>
                        <th>Transfer</th>
                        <th>Araç</th>
                        <th>Rehber</th>
                        <th>Aktivite</th>
                        <th>Müze</th>
                        <th>Otel</th>
                        <th>Oda Tipi</th>
                        <th>Otel Fiyatı</th>
                        <th>Rehber Fiyatı</th>
                        <th>Aktivite Fiyatı</th>
                        <th>Müze Fiyatı</th>
                        <th>Aktivite Tedarikçi</th>
                        <th>Araç Tedarikçi</th>
                        <th>Şoför</th>
                        <th>Şoför Telefon</th>
                        <th>Plaka</th>
                    </tr>
                </thead>
                <tbody>
                    {% for today in today_jobs %}
                        {% include 'tour/partials/todayjobs.html' %}
                    {% empty %}
                    <tr>
                        <div class="alert alert-warning" role="alert">
                            Hiç operasyon kaydı bulunamadı.
                        </div>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="card" id="cardTomorrow">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h1 class="my-1 card_title">{{ tomorrowtitle|date:"d.m.Y" }}</h1>
            <div>
                <button onclick="downloadCard('cardTomorrow');" class="btn btn-outline-secondary">
                    <i class="fas fa-download"></i> Excel İndir
                </button>
                <button onclick="printCard('cardTomorrow');" class="btn btn-outline-secondary">
                    <i class="fas fa-print"></i> Yazdır
                </button>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover" style="font-size:0.8rem;">
                <thead class="thead-dark">
                    <tr>
                        <th>Etiket</th>
                        <th>İşlem Türü</th>
                        <th>Açıklama</th>
                        <th>Alış Zamanı</th>
                        <th>Tur</th>
                        <th>Transfer</th>
                        <th>Araç</th>
                        <th>Rehber</th>
                        <th>Aktivite</th>
                        <th>Müze</th>
                        <th>Otel</th>
                        <th>Oda Tipi</th>
                        <th>Otel Fiyatı</th>
                        <th>Rehber Fiyatı</th>
                        <th>Aktivite Fiyatı</th>
                        <th>Müze Fiyatı</th>
                        <th>Aktivite Tedarikçi</th>
                        <th>Araç Tedarikçi</th>
                        <th>Şoför</th>
                        <th>Şoför Telefon</th>
                        <th>Plaka</th>
                    </tr>
                </thead>
                <tbody>
                    {% for today in tomorrow_jobs %}
                        {% include 'tour/partials/todayjobs.html' %}
                    {% empty %}
                        <div class="alert alert-warning" role="alert">
                            Hiç operasyon kaydı bulunamadı.
                        </div>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <form method="POST" class="my-4">
        {% csrf_token %}
        <div class="row">
            <div class="col-3">
                <input class="form-control" type="date" name="date_job" required>
            </div>
            <div class="col-3">
                <button class="btn btn-success">İşleri Getir</button>
            </div>
        </div>
    </form>
    <div class="card my-4" id="cardWeek">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h1 class="my-1 card_title">{{ weektitle }}</h1>
            <div>
                <button onclick="downloadCard('cardWeek');" class="btn btn-outline-secondary">
                    <i class="fas fa-download"></i> Excel İndir
                </button>
                <button onclick="printCard('cardWeek');" class="btn btn-outline-secondary">
                    <i class="fas fa-print"></i> Yazdır
                </button>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover" style="font-size:0.8rem;">
                <thead class="thead-dark">
                    <tr>
                        <th>Etiket</th>
                        <th>İşlem Türü</th>
                        <th>Açıklama</th>
                        <th>Alış Saati</th>
                        <th>Tur</th>
                        <th>Transfer</th>
                        <th>Araç</th>
                        <th>Rehber</th>
                        <th>Aktivite</th>
                        <th>Müze</th>
                        <th>Otel</th>
                        <th>Oda Tipi</th>
                        <th>Otel Fiyatı</th>
                        <th>Rehber Fiyatı</th>
                        <th>Aktivite Fiyatı</th>
                        <th>Müze Fiyatı</th>
                        <th>Aktivite Tedarikçi</th>
                        <th>Araç Tedarikçi</th>
                        <th>Şoför</th>
                        <th>Şoför Telefon</th>
                        <th>Plaka</th>
                    </tr>
                </thead>
                <tbody>
                    {% for today in week_jobs %}
                        {% include 'tour/partials/todayjobs.html' %}
                    {% empty %}
                        <div class="alert alert-warning" role="alert">
                            Hiç operasyon kaydı bulunamadı.
                        </div>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock content %}
{% block js %}
    <script>
        function printCard(cardId) {
            var content = document.getElementById(cardId).innerHTML;
            var originalContent = document.body.innerHTML;

            document.body.innerHTML = content;

            window.print();

            document.body.innerHTML = originalContent;
        }
    </script>
    <script>
        function printCard(cardId) {
            var content = document.getElementById(cardId).innerHTML;
            var originalContent = document.body.innerHTML;

            document.body.innerHTML = content;

            window.print();

            document.body.innerHTML = originalContent;
        }

        function downloadCard(cardId) {
            var cardElement = document.getElementById(cardId);
            var elt = cardElement.getElementsByTagName('table')[0];
            var titleElement = cardElement.getElementsByClassName('card_title')[0];
            var titleText = titleElement ? titleElement.innerText : 'Download';
            var fileName = titleText.replace(/[^a-z0-9]/gi, '_').toLowerCase() + ".xlsx"; // Sanitize title text to use as filename

            var wb = XLSX.utils.table_to_book(elt, {sheet: "Sheet JS"});
            XLSX.writeFile(wb, fileName);
        }
    </script>
{% endblock %}



